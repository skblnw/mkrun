* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v1.8 on Mar, 02. 2017. JOBID=1488440802
* INPUT FILES FOR EQUILIBRATION
* 

DIMENS CHSIZE 3000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

! Read the system information
stream ../step3_size.str
stream ../step5_assembly.str

! Read PSF and Coordinates
open read unit 10 card name ../step5_assembly.psf
read psf  unit 10 card
open read unit 10 card name ../step5_assembly.crd
read coor unit 10 card
!
! Image Setup
!
open read unit 10 card name ../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
calc xcen = @A / 2
calc ycen = @B / 2
calc zcen = @C / 2
coor translate xdir @xcen ydir @ycen zdir @zcen
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 .or. segid MEMB end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname @posid .or. resname @negid end

!
! Nonbonded Options
!

omm on

system "python ../checkfft.py ?XTLA ?XTLB ?XTLC > checkfft.str"
stream checkfft.str

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
! Setup Restraints for Protein and Lipids (see membrane_lipid_restraint.str)
!
! Suggested Equilibration Scheme [Reducing Force Constants]
! (5 Cycles, 1 cycle = 50 - 100 ps )
!------------------------------------------------------------------------
!        1 cycle    2 cycle    3 cycle    4 cycle    5 cycle    6 cycle
!------------------------------------------------------------------------
! mforce    2.5        2.5        1.0        0.5        0.1        0.0
! ion      10.0        0.0        0.0        0.0        0.0        0.0
!------------------------------------------------------------------------
!


set mforce =  2.5   ! force constant to keep the lipid head groups close to target values

stream membrane_lipid_restraint.charmm_openmm.str

set fcis   =   250  ! dihedral restraint force constant to keep the cis double bonds
set fc2    =   250   ! dihedral restraint force constant to keep the c2  chirality

stream ../membrane_lipid_restraint2.str

!
! Minimization
!

mini sd   nstep 250
mini abnr nstep 250
mini sd   nstep 250
mini abnr nstep 250
mini sd   nstep 250
mini abnr nstep 250
mini sd   nstep 250
mini abnr nstep 250
mini sd   nstep 500
mini abnr nstep 500

!
! Equilibration
!------------------------------------------------------------------------
! To reduce the possible problem with the numerical integration with
! the uncorrelated system, 1 fs time-step is used only for the first-step of
! equilibration.
! It is still possible that you may need to use 1 fs for the next equilibration
! steps if your system is initially very very unstable (rare cases).
!
! ** Note: change "nstep" to reduce the number of dynamics steps
!
set nstep = 25000

set temp = 310
shake bonh param fast
scalar fbeta set 3.0 select .not. type H* end

open write unit 12 card name step6.1_equilibration.rst

DYNA LANGEVIN -
     start         nstep  @nstep  timestp 0.001  -
     inbfrq    -1  imgfrq     -1  ihbfrq      0  ilbfrq      0 -
     firstt @temp  finalt  @temp  tstruc  @temp  iseed 1488440802 -
     tbath  @temp  rbuf      0.0  -
     iunread   -1  iunwrite   12  iuncrd     -1  iunvelo    -1 -
     nsavc      0  nsavvelo    0  -
     nprint  1000  iprfrq   1000  isvfrq   1000  ntrfrq   5000 -
     iasvel     1 -
     omm langevin gamma 10

!
! write some information
!

open write unit 10 card name step6.1_equilibration.pdb
write coor unit 10 pdb
* 6.1 PDB
*
close unit 10

open write unit 10 card name step6.1_equilibration.crd
write coor unit 10 card
* 6.1 CRD
*
close unit 10

open write card  unit 51 name step6.1_equilibration.str
write title unit 51
* set BOXtype  = @BOXtype
* set XTLtype  = @XTLtype
* set A        = @A
* set B        = @B
* set C        = @C
* set Alpha    = @Alpha
* set Beta     = @Beta
* set Gamma    = @Gamma
* set Xcen     = @xcen
* set Ycen     = @ycen
* set Zcen     = @zcen
* set posid    = @posid
* set negid    = @negid
* set Npos     = @Npos
* set Nneg     = @Nneg
* set NLIPID   = @nlipid
* set NLIPTOP  = @nliptop
* set NLIPBOT  = @nlipbot
* set Nwater   = @nwater
* set fftx     = @fftx
* set ffty     = @ffty
* set fftz     = @fftz
*

stop