* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v1.8 on Mar, 02. 2017. JOBID=1488440802
* INPUT FILES FOR EQUILIBRATION
* 

DIMENS CHSIZE 3000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

! Read the system information
stream ../step3_size.str
stream step6.1_equilibration.str

! Read PSF and Coordinates
open read unit 10 card name ../step5_assembly.psf
read psf  unit 10 card
open read unit 10 card name ../step5_assembly.crd
read coor unit 10 card
!
! Image Setup
!
open read unit 10 card name ../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
coor translate xdir @xcen ydir @ycen zdir @zcen
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 .or. segid MEMB end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname @posid .or. resname @negid end

!
! Nonbonded Options
!

omm on

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
! Equilibration (change "nstep" to reduce the number of dynamics steps)
!


set mforce = 0.5   ! force constant to keep the lipid head groups close to target values

stream membrane_lipid_restraint.charmm_openmm.str

set fcis   =  50  ! dihedral restraint force constant to keep the cis double bonds
set fc2    =  50   ! dihedral restraint force constant to keep the c2  chirality

stream ../membrane_lipid_restraint2.str

!
! Equilibration
!------------------------------------------------------------------------
! To reduce the possible problem with the numerical integration with
! the uncorrelated system, 1 fs time-step is used only for the first-step of
! equilibration.
! It is still possible that you may need to use 1 fs for the next equilibration
! steps if your system is initially very very unstable (rare cases).
!
! ** Note: change "nstep" to reduce the number of dynamics steps
!
set nstep = 50000

set temp = 310
shake bonh param fast

open read  unit 11 card name step6.3_equilibration.rst
open write unit 12 card name step6.4_equilibration.rst

DYNA CPT leap restart nstep @nstep timestep 0.002 echeck -1 -
     nprint 1000 iprfrq 5000 ntrfrq 5000 -
     iunrea 11 iunwri 12 iuncrd -1 iunvel -1 kunit -1 -
     nsavc 0 nsavv 0 -
     omm langevin gamma 10 firstt @temp finalt @temp -
     prmc tens 0.00001 przz 1.0 iprsfrq 15

!
! write some information
!

open write unit 10 card name step6.4_equilibration.pdb
write coor unit 10 pdb
* 6.4 PDB
*
close unit 10

open write unit 10 card name step6.4_equilibration.crd
write coor unit 10 card
* 6.4 CRD
*
close unit 10

stop